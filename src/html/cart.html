<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>cart</title>
    <link rel="stylesheet" type="text/css" href="../css/common.css" />
    <link rel="stylesheet" type="text/css" href="../css/cart.css" />
</head>
<body>

    <!-- 头部菜单栏 -->
    <div class="top container">
       <!--  <div class="top_img">
            <img src="img/1top.png" alt="" />
        </div> -->
        <div class="top_leader">
            <!-- 天气 -->
            <div class="tianqi fl">
                <a href="#" class="change-city "><i></i>广州市区&nbsp;&nbsp;&nbsp;&nbsp;<em></em></a>
                <!-- 天气二级导航 -->
                <div class="tianqi_scd"></div>
            </div>
            <!-- 注册登录 -->
            <div class="top-login fl">
                <p>Hi,欢迎来九机！&nbsp;&nbsp;&nbsp;<a href=""class="underline">登录&nbsp;&nbsp;</a><a href=""class="underline">免费注册</a></p>
            </div>

            <!-- 顶部菜单 -->
            <div class="top-menu fr">

                <div class="personal fl">
                    <a href="" class="personal1">个人中心<i></i></a>
                    <div class="personal_scd"></div> 
                </div>

                <a href="" class="club"><i></i>会员俱乐部</a>
                <a href="" class="help">帮助中心</a>

                <!-- 客户端 -->
                <div class="customer">
                    <a href="" class="customer1"><i></i>客户端</a>
                    <div class="customer_scd"></div>  
                </div>

                <a href="" class="online">在线客服</a>

                <!-- 网站导航 -->
                <div class="nivigator">
                    <a href="" class="nivigator1">网站导航<i></i></a>
                    <div class="nivigator_scd"></div>
                </div>
                

                <a href="" class="report"><i></i>不良信息举报</a>

                <!-- 电话 -->
                <div class="call">
                    <a href="" class="call1"><i></i>400-008-3939</a>
                    <div class="call_scd"></div>
                </div>
                
            </div>
        </div>
    </div>

    <!-- cart wraper -->
    <div class="cart_wraper">

        <!-- cart header -->
        <div class="order_head overflow-hide">
            <a href="/" class="order_logo fl">
                <!-- <img src="//img2.ch999img.com/static/images/new-logo.png"> -->
            </a> 
            <div class="order-step">
                <dl class="cur">
                    <dt>1</dt>
                    <dd>我的购物车</dd>
                </dl> 
                <dl>
                    <dt>2</dt>
                    <dd>填写核对订单</dd>
                </dl> 
                <dl>
                    <dt>3</dt>
                    <dd>付款</dd>
                </dl>
            </div>


        </div>



        <!-- cartbox -->
        <div class="cart_box">
            <!-- 没有添加商品时  空 -->
            <!-- <div class="cart_nothing">
                <img src="../img/cart_car.png" alt="" />
                <p>购物车里还没有商品，快 
                    <a href="/" target="_parent" class="main-color">去逛逛</a> 吧
                </p>
            </div> -->

            <!-- 添加商品时  -->
            <div class="cart_guess_box">


                <div class="cart_guess_boxtop">
                    <div class="cart_tab">
                        <div class="cart_tableft">
                            <a href="javascript:;" class="cur">全部商品 
                                <span class="main_color"></span>
                            </a>
                        </div>
                        <p class="cart_tabright">已选 
                                <span class="main_color">1</span> 件，合计（不含运费）
                                <b class="main-color">￥3388.00</b>
                        </p>

                    
                    </div>
                </div>

                <div class="cart_guess_boxmid">


                    <div class="cart_title">
                        <div class="cart_check">
                            <label class="checkbox radio_box">
                                <input type="checkbox" id="checkAll">全选
                            </label>
                        </div> 

                        <div class="cart_product_box">

                            <div class="product">商品</div> 
                            <div class="unit_price">单价（元）</div> 
                            <div class="discount">优惠（元）</div> 
                            <div class="count">数量</div> 
                            <div class="sum">小计（元）</div><div class="action">操作</div>

                        </div>
                    </div>
                    <div class="cart_goods">

                        <div class="cart_check1">
                            <label for="" class="radiobox">
                                <input type="checkbox" checked/>
                            </label>
                        </div>

                        <div class="cart_goodslist">
                            <!-- <div class="product"></div> 
                            <div class="unit_price"></div> 
                            <div class="discount"></div> 
                            <div class="count"></div> 
                            <div class="sum"></div><div class="action"></div> -->
                        </div>
                    </div>

                </div>


                <div class="cart_guess_boxbottom">
                    <div class=""></div>
                    <div class=""></div>
                    <div class=""></div>
                </div>
            </div>
        </div>



    </div>
<script type="text/javascript" src="../js/jiujicommon.js"></script>

<script type="text/javascript" >
    document.addEventListener('DOMContentLoaded',()=>{
            var carList = document.querySelector('.cart_goodslist');
            var SubPrice = document.querySelector('#subPrice');
            var goodslist = Cookie.get('goodslist');//'[{}]',''

            if(goodslist.length<=0){

                        goodslist = [];

                    }else{
                        goodslist = JSON.parse(goodslist);
                    }
            console.log(goodslist);

             render();
             
            function render(){


                // 根据数据生成html结构
                var ul = document.createElement('ul');

                // 计算总价
                //goodstotal是单个商品的总价  total是全部商品的总价
                var goodstotal = 0;
                var total = 0;
                var arrgoods = [];
                    arrgoods.push (goodslist);
                // for (var i in goodslist) {
                //         arrgoods.push(goodslist[i]); //属性
                //         //arr.push(object[i]); //值
                //     }
                ul.innerHTML = arrgoods.map(function(goods){
                            // 计算总价
                   // total += goods.price_p * goods.qty;
                   console.log('222');


                    return  '<img src="'+goodslist.imgurl+'" id="mypic"/>' +
                            '<div id="car_list_1">'+               
                            '<h4>'+goodslist.name+'</h4>' + 
                            // '<p>ID:#24234</p>' +
                            // '<p>Size:Default</p>' +
                            '</div><div id="car_list_2">'+ goodslist.qty +'</div>'+
                            '<div id="car_list_3"><p class="price_p">'+goodslist.price_p+'</p></div>' + 
                            '<div id="car_list_4"><p class="price_t">'+goodslist.price_p +'</p></div>' + 
                            '<div id="car_list_5"><span class="btn-close">&times;</span></div>'
                            '</li>';
                        }).join('\n');

                        // 把ul写入页面#carList
                        carList.innerHTML = '';
                        carList.appendChild(ul);


                        // 写入总价
                        // SubPrice.innerHTML = total.toFixed(2);
                    }


            // 删除购物车单个商品
            // * 找出删除的商品 -> 从数组中移除 -> 重写cookie -> 渲染页面
                

            carList.onclick = function(e){

                e = e || window.event;

                var target = e.target || e.srcElement;

                // 判断是否点击了按钮
                if(target.className === 'btn-close'){
                 // 获取当前li
                    var currentLi = target.parentNode.parentNode;


                     // 获取当前商品的guid
                    var guid = currentLi.getAttribute('data-guid');
            // 找出数组中对应商品并移除
                    for(var i=0;i<goodslist.length;i++){
                        if(goodslist[i].guid === guid){
                            goodslist.splice(i,1);
                            break;
                            }
                        }

                    // 重写cookie
                    Cookie.set('goodslist',JSON.stringify(goodslist));

            // 重新渲染页面
                    render();
                        }
                    }
    })
</script>
</body>
</html>